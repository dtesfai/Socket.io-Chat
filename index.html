<!doctype html>
<html>
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Socket.IO chat</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">

  <style>
    /** { margin: 0; padding: 0; box-sizing: border-box; }*/
    body { font: 13px Helvetica, Arial; }
    /*form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }*/
    /*form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }*/
    /*form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }*/
    #messages { list-style-type: none; margin: 0; padding: 0; }
    #messages li { padding: 5px 10px; }
    #messages li:nth-child(odd) { background: #eee; }
    #typing { padding: 5px 10px; }
  </style>

  <!-- JS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="./user.js"></script>
  <script>
    $(function () {

      // Generating a random username
      var user = "";
      var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

      for( var i=0; i < 3; i++ )
          user += possible.charAt(Math.floor(Math.random() * possible.length));

      // creating io socket
      var socket = io();

      // letting others know that user connected, prints you connected to localhost
      socket.emit('connection', user + ' connected', user);
      $('#messages').append($('<li>').text("you connected"));


      // runs when user is typing
      $('#m').on('keydown', function(e){
        if(e.keyCode != 13){
          socket.emit('typing', user + "is typing")
        }
      });

      var typingTimer;                //timer identifier
      var doneTypingInterval = 2000;  //time in ms (5 seconds)
      
      // check every 1/2 second if user still typing (WIP)
      $('#m').keyup(function(){
          clearTimeout(typingTimer);
          if ($('#m').val()) {
              typingTimer = setTimeout(socket.emit('not typing'), doneTypingInterval);
          }
      });

      // when message sent, stored in variable and displayed to localhost screen, sent as chat message to 
      $('form').submit(function(){
        var msg = user + ": " + $('#m').val();
        $('#messages').append($('<li>').text(msg));
        socket.emit('chat message', msg);
        $('#m').val('');
        return false;
      });

      socket.on('message', function(msg){
        $('#messages').append($('<li>').text(msg));
      });

      // want to show msg when typing, hide when not
      socket.on('typing', function(msg){
        $('#typing').text(msg);
        $("#typing").show();
      });

      socket.on('not typing', function(msg){
        $("#typing").hide();
      });

      socket.on('online', function(arr){
        $("#online").empty();
        document.getElementById('online').appendChild(makeUL(arr));
      });

    });
  </script>

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="images/favicon.png">

</head>

<body>


  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="nine columns" style="margin-top: 25%">
        <ul id="messages"></ul>
        <p id="typing" style="color:grey"></p>
        <form action="">
          <input style='width:85%;' id="m" autocomplete="off" />
          <button>Send</button>
        </form>
      </div>
      <div class="three columns" style="margin-top: 25%">
        <h3>Online</h3>
        <ul id="online"></ul>
      </div>
    </div>
  </div>

  

</body>
</html>